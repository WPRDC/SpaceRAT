id: parcel
name: Parcel
id_field: parcel_id
table: parcel_index
subgeographies: # leaf, besides points
query: >
  SELECT sub.parcel_id,
         sub.block_lot,
         sub.class,
         sub.housenum,
         sub.fraction,
         sub.unit,
         sub.street,
         sub.city,
         sub.state,
         sub.zip,
         sub.address,
         sub.owner_occupied,
         sub.geom,
         sub.centroid,
         (sub.parcel_id || ' '::text) || sub.address AS _full_text
  FROM (SELECT assessment."PARID"            AS parcel_id,
               boundary."MAPBLOCKLO"         AS block_lot,
               assessment."CLASSDESC"        AS class,
               assessment."PROPERTYHOUSENUM" AS housenum,
               assessment."PROPERTYFRACTION" AS fraction,
               assessment."PROPERTYUNIT"     AS unit,
               assessment."PROPERTYADDRESS"  AS street,
               assessment."PROPERTYCITY"     AS city,
               assessment."PROPERTYSTATE"    AS state,
               assessment."PROPERTYZIP"      AS zip,
               (((((((assessment."PROPERTYHOUSENUM" || ' '::text) || assessment."PROPERTYADDRESS") || ' '::text) ||
                   assessment."PROPERTYCITY") || ' '::text) || assessment."PROPERTYSTATE") || ' '::text) ||
               assessment."PROPERTYZIP"      AS address,
               (assessment."HOMESTEADFLAG" IS NOT NULL
                OR assessment."CHANGENOTICEADDRESS1" ILIKE assessment."PROPERTYHOUSENUM" || '%') AS owner_occupied,
               boundary._geom                AS geom,
               st_centroid(boundary._geom)   AS centroid
        FROM "65855e14-549e-4992-b5be-d629afc676fa" assessment
                 JOIN "3f50d47a-ab54-4da2-9f03-8519006e9fc9" boundary
                      ON assessment."PARID" = boundary."PIN") sub;
variants:
  residential: >
    "class" LIKE 'RESIDENTIAL'
  commercial: >
    "class" LIKE 'RESIDENTIAL'
  industrial: >
    "class" LIKE 'INDUSTRIAL'
  owner_occupied: >
    "owner_occupied"
